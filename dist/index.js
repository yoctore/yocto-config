"use strict";function Config(){this.config={},this.state=!1,this.env="development",this.base=path.normalize(["./",__dirname].join("")),this.logger=logger,this.schema=joi.object().min(1).keys({app:joi.object().required().keys({name:joi.string().required().empty().min(3),stackError:joi["boolean"]().required(),session:joi.object().required().keys({timeout:joi.number().required()}).allow("timeout")}).allow("name","stackError","session"),express:joi.object().required().keys({jsonp:joi["boolean"]().required(),prettyHtml:joi["boolean"]().required(),viewEngine:joi.string().required().allow("jade"),filter:joi.object().required().keys({rules:joi.string().required().empty(),by:joi.string().required().allow("Content-Type"),level:joi.number().required().min(0).max(9)}).allow("rules","by","level"),session:joi.object().required().keys({enable:joi["boolean"]().required(),options:joi.object().optional().keys({secret:joi.string().required().min(8),name:joi.string().required().min(5),secure:joi["boolean"]().required(),genuuid:joi["boolean"]().required(),proxy:joi["boolean"]().required(),resave:joi["boolean"]().required(),saveUninitialized:joi["boolean"]().required()}).allow("secret","name","secure","genuuid","proxy","resave","saveUninitialized")}).allow("enable","options"),vhost:joi.object().required().keys({enable:joi["boolean"]().required(),options:joi.object().optional().keys({url:joi.string().required(),aliases:joi.array().items(joi.string().required().empty()),subdomains:joi["boolean"]().required(),http:joi.object().required().keys({redirect:joi.object().required().keys({type:joi.number(),url:joi.string().required().empty(),port:joi.number().required()}).allow("type","url","port")}).allow("redirect")}).allow("url","aliases","subdomains","http")}).allow("enable","options")}),env:joi.string().required().valid(["development","staging","production"]),port:joi.number().required(),directory:joi.array().required().items([joi.object().required().keys({models:joi.string().required().empty().min(3)}),joi.object().required().keys({controllers:joi.string().required().empty().min(3)}),joi.object().required().keys({views:joi.string().required().empty().min(3)}),joi.object().required().keys({"public":joi.string().required().empty().min(3)}),joi.object().required().keys({icons:joi.string().required().empty().min(3)})]),encrypt_key:joi.object().required().keys({key:joi.string().required(),type:joi.string().required().valid(["ascii","utf8","utf16le","ucs2","base64","binary","hex"])})}).unknown(!0)}var path=require("path"),_=require("lodash"),logger=require("yocto-logger"),joi=require("joi"),fs=require("fs"),glob=require("glob"),util=require("util");Config.prototype.set=function(a,b){return _.isUndefined(a)||!_.isString(a)||_.isEmpty(a)?this.logger.warning("[ Core.set ] - Invalid value given. name must be a string and not empty. Operation aborted !"):("base"==a&&"."==b.charAt(0)&&(b=path.normalize([process.cwd(),b].join("/"))),this[a]=b),this},Config.prototype.get=function(a){return this[a]},Config.prototype.reload=function(a){return _.isUndefined(a)||_.isNull(a)||!_.isString(a)||_.isEmpty(a)||(this.base=a),this.load()},Config.prototype.load=function(){try{var a={},b=path.normalize([this.base,"*.json"].join("/")),c=path.normalize([this.base,[this.env,".json"].join("")].join("/")),d=glob.sync(b);if(_.isEmpty(d))throw"No path was found. operation aborted !";d=_.sortBy(d,function(a){var b=path.normalize([this.base,"all.json"].join("/")),c=path.normalize([this.base,"common.json"].join("/")),d=path.normalize([this.base,"development.json"].join("/")),e=path.normalize([this.base,"staging.json"].join("/")),f=path.normalize([this.base,"production.json"].join("/"));return[a==f,a==e,a==d,a==c,a==b,a==a].join("|")},this),_.each(d,function(b){var d=JSON.parse(fs.readFileSync(b,"utf-8"));return _.merge(a,d),c!=b});var e=joi.validate(a,this.get("schema"),{abortEarly:!1});if(!_.isNull(e.error))throw _.each(e.error.details,function(a){this.logger.warning(["[ Config.load ] - Cannot update config an error occured. Error is :",util.inspect(a,{depth:null})].join(" "))},this),"Config validation failed";_.each(a.directory,function(a){var b=_.first(_.values(a));"."==b.charAt(0)&&(b=path.normalize([process.cwd(),b].join("/")));var c=[_.first(_.keys(a)),"directory"].join("_").toUpperCase();this[c]=b},this),this.state=!0,this.config=a,this.logger.info(["[ Config.load ] - Success - Config file was changed with files based on :",this.base].join(" "))}catch(f){return this.logger.error(["[ Config.load ] - an error occured during load config file. Error is :",f].join(" ")),!1}return!0},module.exports=new Config;