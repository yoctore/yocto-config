"use strict";function Config(){this.config={},this.state=!1,this.env="development",this.base=path.normalize([process.cwd(),__dirname].join("")),this.logger=logger,this.schema=joi.object().min(1).keys({app:joi.object().required().keys({name:joi.string().required().empty().min(3),stackError:joi["boolean"]()["default"](!0),session:joi.object()["default"]({timeout:5e4}).keys({timeout:joi.number()["default"](5e5)}).allow("timeout")}).allow("name","stackError","session"),express:joi.object().required().keys({jsonp:joi["boolean"]()["default"](!1),prettyHtml:joi["boolean"]()["default"](!0),viewEngine:joi.string().empty()["default"]("jade").allow("jade"),filter:joi.object()["default"]({rules:"json|text|javascript|css|html",by:"Content-type",level:9}).keys({rules:joi.string()["default"]("json|text|javascript|css|html").empty(),by:joi.string()["default"]("Content-Type").allow("Content-Type"),level:joi.number()["default"](9).min(0).max(9)}).allow("rules","by","level"),cookieParser:joi["boolean"]()["default"](!1),json:joi["boolean"]()["default"](!1),multipart:joi["boolean"]()["default"](!1),session:joi.object()["default"]({enable:!1}).keys({enable:joi["boolean"]()["default"](!0),options:joi.object().optional().keys({cookie:joi.object()["default"]({path:"/",httpOnly:!1,secure:!0,maxAge:null}).keys({path:joi.string().optional()["default"]("/"),httpOnly:joi["boolean"]().optional()["default"](!1),secure:joi["boolean"]().optional()["default"](!0),maxAge:joi.number().optional()["default"](null)}).allow("path","httpOnly","secure","maxAge"),secret:joi.string().optional().min(8)["default"]("yocto-config-secret-key"),name:joi.string().optional().min(5)["default"]("connect.sid"),genuuid:joi["boolean"]().optional()["default"](!1),proxy:joi["boolean"]().optional()["default"](void 0),resave:joi["boolean"]().optional()["default"](!1),saveUninitialized:joi["boolean"]().optional()["default"](!0),rolling:joi["boolean"]().optional()["default"](!1)}).allow("cookie","secret","name","genuuid","proxy","resave","saveUninitialized","rolling")}).allow("enable","options"),vhost:joi.object().optional().keys({enable:joi["boolean"]().required()["default"](!1),options:joi.object().optional().keys({url:joi.string().required()["default"]("/"),aliases:joi.array().items(joi.string().required().empty()),subdomains:joi["boolean"]().required()["default"](!1),http:joi.object().optional().keys({redirect:joi.object().required().keys({type:joi.number(),url:joi.string().required().empty(),port:joi.number().required()}).allow("type","url","port")}).allow("redirect")}).allow("url","aliases","subdomains","http")}).allow("enable","options")}),env:joi.string()["default"]("development").empty().valid(["development","staging","production"]),port:joi.number()["default"](3e3),directory:joi.array().min(1).unique()["default"]([{models:"/"},{controllers:"/"},{views:"/"},{"public":"/"},{icons:"/"}]).items([joi.object().required().keys({models:joi.string().empty().min(2)["default"]("/")}),joi.object().required().keys({controllers:joi.string().empty().min(2)["default"]("/")}),joi.object().required().keys({views:joi.string().empty().min(2)["default"]("/")}),joi.object().required().keys({"public":joi.string().empty().min(2)["default"]("/")}),joi.object().required().keys({icons:joi.string().empty().min(2)["default"]("/")}),joi.object().empty()]),encrypt_key:joi.object()["default"]({key:"MyAppKey",type:"hex"}).keys({key:joi.string()["default"]("MyAppKey").empty(),type:joi.string()["default"]("hex").valid(["ascii","utf8","utf16le","ucs2","base64","binary","hex"])})}).unknown(!0)}var path=require("path"),_=require("lodash"),logger=require("yocto-logger"),joi=require("joi"),fs=require("fs"),glob=require("glob"),util=require("util");Config.prototype.set=function(a,b){return _.isUndefined(a)||!_.isString(a)||_.isEmpty(a)?this.logger.warning("[ Core.set ] - Invalid value given. name must be a string and not empty. Operation aborted !"):("base"==a&&"."==b.charAt(0)&&(b=path.normalize([process.cwd(),b].join("/"))),this[a]=b),this},Config.prototype.get=function(a){return this[a]},Config.prototype.reload=function(a){return _.isUndefined(a)||_.isNull(a)||!_.isString(a)||_.isEmpty(a)||(this.base=a),this.load()},Config.prototype.load=function(){try{var a={},b=path.normalize([this.base,"*.json"].join("/")),c=path.normalize([this.base,[this.env,".json"].join("")].join("/")),d=glob.sync(b);if(_.isEmpty(d))throw"No path was found. operation aborted !";d=_.sortBy(d,function(a){var b=path.normalize([this.base,"all.json"].join("/")),c=path.normalize([this.base,"common.json"].join("/")),d=path.normalize([this.base,"development.json"].join("/")),e=path.normalize([this.base,"staging.json"].join("/")),f=path.normalize([this.base,"production.json"].join("/"));return[a==f,a==e,a==d,a==c,a==b,a==a].join("|")},this),_.each(d,function(b){var d=JSON.parse(fs.readFileSync(b,"utf-8"));return _.merge(a,d),c!=b});var e=joi.validate(a,this.get("schema"),{abortEarly:!1});if(!_.isNull(e.error))throw _.each(e.error.details,function(a){this.logger.warning(["[ Config.load ] - Cannot update config an error occured. Error is :",util.inspect(a,{depth:null})].join(" "))},this),"Config validation failed";_.each(a.directory,function(a){var b=_.first(_.values(a));"."==b.charAt(0)&&(b=path.normalize([process.cwd(),b].join("/")));var c=[_.first(_.keys(a)),"directory"].join("_").toUpperCase();this[c]=b},this),this.state=!0,this.config=e.value,this.logger.info(["[ Config.load ] - Success - Config file was changed with files based on :",this.base].join(" "))}catch(f){return this.logger.error(["[ Config.load ] - an error occured during load config file. Error is :",f].join(" ")),!1}return!0},module.exports=new Config;